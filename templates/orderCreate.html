{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Создать Заказ</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
</head>
<body>
    <div class="sidebar">
        <nav>
            <a href="{% url 'order_list_page' %}">
                <div class="logo">
                    <img src="{% static 'images/logo.jpg' %}" alt="Space Logistic">
                </div>
            </a>
        </nav>
        <nav>
            <ul>
                <li>
                    <a href="{% url 'profile_page' %}">
                        <div class="person">
                            <img src="{% static 'images/person.png' %}" alt="Profile">
                        </div>
                    </a>
                </li>
                <li>
                    <a href="{% url 'order_list_page' %}">
                        <div class="mylist">
                            <img src="{% static 'images/mylist.png' %}" alt="My List">
                        </div>
                    </a>
                </li>
                <li>
                    <a href="{% url 'order_create_page' %}">
                        <div class="pluslist">
                            <img src="{% static 'images/pluslist.png' %}" alt="Add Order">
                        </div>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <div class="plusperson">
                            <img src="{% static 'images/plusperson.png' %}" alt="Add Person">
                        </div>
                    </a>
                </li>
            </ul>
        </nav>
        <button class="logout">⇦</button>
    </div>

    <div class="main">
        <div class="top-bar">
            <div>
                <button class="lang-btn" data-lang="kz">KZ</button>
                <button class="lang-btn" data-lang="ru">RU</button>
                <button class="lang-btn" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="cn">CN</button>
            </div>
            <div class="user">{{ user.username }}</div>
        </div>

    <h2 data-i18n="createDeal">Создать заказ</h2>
        <form id="createOrderForm">
            <!-- Блок 1: Основные данные -->
            <div class="form-group">
                <label data-i18n="client">Клиент</label>
                <select name="client_id" id="client-select" class="form-control" required>
                    <option value="">Выберите клиента...</option>
                    {% for client in clients %}
                        <option value="{{ client.id }}">{{ client.name }}</option>
                    {% endfor %}
                </select>
                <label data-i18n="currency" style="margin-top: 10px;">Валюта</label>
                <select name="currency" class="form-control" required>
                    {% for code, name in currency_choices %}
                        <option value="{{ code }}">{{ name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-row">
                <input type="text" name="transition_point" placeholder="Точка перехода" data-i18n="crossing" required value="Horgos" />
                <input type="text" name="destination" placeholder="Место назначения" data-i18n="destination" required value="Almaty" />
            </div>
            <div class="form-row">
                <input type="text" name="shipper" placeholder="Отправитель" data-i18n="sender" required value="«Horgos journey international trading co. ,LTD »" />
                <input type="text" name="consignee" placeholder="Получатель" data-i18n="receiver" required value="AО «KTZ Express», БИН 020540016156 по поручению TOO «Space Logistics KZ», БИН 221240008077" />
            </div>
            <div class="form-row">
                <input type="text" name="shipper_address" placeholder="Адрес отп." data-i18n="senderAddress" required value="Местонахождение Room 06. first floor,international customer service center ,no. 1 Beijing road,Horgos city, yili, xinjiang" />
                <input type="text" name="consignee_address" placeholder="Адрес получателя" data-i18n="receiverAddress" required value="Местонахождение: Республика Казахстан 010017, г.Астана, ул. Кунаева, 10 БЦ Изумрудный квартал, 25 этаж" />
            </div>

            <!-- Блок 2: Транспорт и Вес -->
            <div class="form-row">
                <input type="text" name="car_number" placeholder="Номер машины" data-i18n="carNumber" required />
                <input type="number" step="0.01" id="car_weight_input" name="car_weight" placeholder="Вес машины" data-i18n="carWeight" required />
            </div>
             <div class="form-row">
                <input type="text" name="trailer_number" placeholder="Номер Прицепа" data-i18n="trailerNumber" required />
                <input type="number" step="0.01" id="trailer_weight_input" name="trailer_weight" placeholder="Вес Прицепа" data-i18n="trailerWeight" required />
            </div>
             <div class="form-row">
                <input type="number" step="0.01" id="loaded_weight_input" name="loaded_weight" placeholder="Общий Вес" data-i18n="loadedWeight" required />
                <input type="text" name="driver_number" placeholder="Номер водителя" data-i18n="driverNumber" />
            </div>
            
            <div class="form-group">
                <label data-i18n="label_weight_for_distr">Вес для распределения:</label>
                <div id="target-weight" class="details-field" style="color: #27ae60; font-weight: bold;">0.00 kg</div>
            </div>
            
            <!-- Блок 3: Товары -->
            <hr>
            <h3 data-i18n="orderGoods">Товары заказа</h3>
            <div id="product-rows-container"></div>
            <div class="form-row" style="align-items: center; background-color: #f2f2f2; padding: 10px; border-radius: 5px; margin-top: 10px;">
                <strong style="margin-right: auto;" data-i18n="label_total_by_products">Итог по товарам:</strong>
                <div><span data-i18n="label_sum_of_weights">Сумма весов</span>: <strong id="current-sum-display">0.00 kg</strong></div>
                <div style="margin-left: 20px;"><span data-i18n="label_difference">Разница</span>: <strong id="weight-difference-display" style="color: red;">0.00 kg</strong></div>
            </div>
            <br>
            <button type="button" id="addProductBtn" class="file-btn" data-i18n="add">Добавить товар</button>
            
            <hr>
            <!-- ДОБАВЛЕН ID "saveOrderBtn" -->
            <button type="submit" id="saveOrderBtn" data-i18n="button_save_order">Сохранить заказ</button>
        </form>

        <template id="product-row-template">
            <div class="form-row product-row" style="align-items: center; border-top: 1px solid #eee; padding-top: 10px; margin-top:10px;">
                <select name="product" class="form-control product-select" required></select>
                <input type="number" name="quantity" placeholder="К-во" class="form-control" data-i18n="quantity" required value="1" />
                <input type="number" step="0.01" name="gross_weight" placeholder="Вес Брутто" class="form-control gross-weight-input" data-i18n="grossWeight" required />
                <button type="button" class="remove-product-btn file-btn" style="background-color: #c0392b;">Удалить</button>
            </div>
        </template>
        
        <script>
            // Эта строка создает глобальную переменную all_products, доступную для main.js
            const all_products = JSON.parse('{{ products_json|safe|default:"[]" }}');
        </script>

        <script src="{% static 'js/main.js' %}"></script>
</body>
</html>